<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoxZero ç®—ç‰Œå™¨</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        anthropic: {
                            dark: '#141413',
                            light: '#faf9f5',
                            mid: '#b0aea5',
                            lightgray: '#e8e6dc',
                            orange: '#d97757',
                            blue: '#6a9bcc',
                            green: '#788c5d',
                            hoverorange: '#c26547'
                        }
                    },
                    fontFamily: {
                        heading: ['Poppins', 'Arial', 'sans-serif'],
                        body: ['Lora', 'Georgia', 'serif']
                    }
                }
            }
        }
    </script>
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=Poppins:wght@400;600;700&display=swap"
        rel="stylesheet">
    <!-- noUiSlider -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wnumb/1.2.0/wNumb.min.js"></script>

    <style>
        body {
            background-color: theme('colors.anthropic.light');
            color: theme('colors.anthropic.dark');
            font-family: theme('fontFamily.body');
        }

        h1,
        h2,
        h3,
        h4,
        .heading-font {
            font-family: theme('fontFamily.heading');
        }

        /* Customizes noUiSlider with Anthropic styling */
        .noUi-target {
            background: theme('colors.anthropic.lightgray');
            border-radius: 99px;
            border: none;
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.1);
        }

        .noUi-handle {
            background: #fff;
            border-radius: 50%;
            border: 2px solid theme('colors.anthropic.dark');
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: grab;
        }

        .noUi-handle:before,
        .noUi-handle:after {
            display: none;
        }

        .noUi-handle:active {
            cursor: grabbing;
        }

        /* Suit specific track colors based on Anthropic variants */
        .color-spade .noUi-connect {
            background: theme('colors.anthropic.dark');
        }

        .color-heart .noUi-connect {
            background: theme('colors.anthropic.orange');
        }

        .color-club .noUi-connect {
            background: theme('colors.anthropic.green');
        }

        .color-diamond .noUi-connect {
            background: theme('colors.anthropic.blue');
        }

        /* Disabled SLider Styling */
        .noUi-target[disabled] {
            opacity: 0.4;
            filter: grayscale(100%);
            cursor: not-allowed;
            pointer-events: none;
            /* Block interactions */
        }

        .noUi-target[disabled] .noUi-handle {
            cursor: not-allowed;
            background: theme('colors.anthropic.lightgray');
            border-color: theme('colors.anthropic.mid');
            box-shadow: none;
        }

        /* Z-index fixes for overlapping handles (7) */
        /* By default, noUiSlider stacks lower handles below higher handles. 
           We use 'drag-tap' behavior and toggle z-index on active */
        .noUi-handle.focus-top {
            z-index: 10 !important;
        }

        /* Custom checkbox cards for hand selection */
        .card-checkbox {
            display: none;
        }

        .card-label-btn {
            background: white;
            border: 1px solid theme('colors.anthropic.lightgray');
            transition: all 0.2s ease;
            cursor: pointer;
            user-select: none;
        }

        .card-checkbox:checked+.card-label-btn {
            background: theme('colors.anthropic.orange');
            color: white;
            border-color: theme('colors.anthropic.orange');
            font-weight: 600;
            transform: scale(1.05);
            /* Micro-animation */
            box-shadow: 0 4px 6px -1px rgba(217, 119, 87, 0.4);
        }

        .card-label-btn:hover {
            border-color: theme('colors.anthropic.mid');
        }

        /* Tiny checkbox customization */
        .custom-checkbox {
            appearance: none;
            background-color: transparent;
            margin: 0;
            font: inherit;
            color: currentColor;
            width: 1.15em;
            height: 1.15em;
            border: 0.15em solid theme('colors.anthropic.mid');
            border-radius: 0.25em;
            display: grid;
            place-content: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .custom-checkbox::before {
            content: "";
            width: 0.65em;
            height: 0.65em;
            transform: scale(0);
            transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em white;
            background-color: white;
            transform-origin: center;
            clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }

        .custom-checkbox:checked {
            background-color: theme('colors.anthropic.orange');
            border-color: theme('colors.anthropic.orange');
        }

        .custom-checkbox:checked::before {
            transform: scale(1);
        }
    </style>
</head>

<body class="min-h-screen py-10 px-4 md:px-0">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-anthropic-dark mb-3 tracking-tight">ğŸ¦Š FoxZero é‚è¼¯æ¨æ¼”ç®—ç‰Œå™¨</h1>
            <p class="text-anthropic-mid italic text-lg opacity-80">æ¡ç”¨äººå·¥æ™ºæ…§èˆ‡è‡ªæˆ‘å°å¼ˆæ¨æ¼”æ‚¨çš„æœ€ä½³æ­¥æ•¸</p>
        </div>

        <!-- 2 Column Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

            <!-- Left Column: Desktop Status -->
            <div class="space-y-8">
                <!-- Section 1: Desktop Status -->
                <div
                    class="bg-white p-6 md:p-8 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-anthropic-lightgray">
                    <h3 class="text-2xl font-bold mb-2 heading-font text-anthropic-dark flex items-center gap-2">
                        <svg class="w-6 h-6 text-anthropic-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                            </path>
                        </svg>
                        æ¡Œé¢ç‹€æ…‹ (å·²å‡ºçš„ç‰Œ)
                    </h3>
                    <p class="text-sm text-anthropic-mid mb-8 font-body">è«‹è¨­å®šæ¯ç¨®èŠ±è‰²å·²å‡ºçš„ç¯„åœï¼Œå‹¾é¸ã€Œæœªç ´å†°ã€å¯åœç”¨è©²èŠ±è‰²ã€‚</p>

                    <div class="space-y-10">
                        <!-- Spade -->
                        <div class="suit-group">
                            <div
                                class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
                                <div class="flex items-center gap-2 font-heading font-semibold text-anthropic-dark">
                                    <!-- Solid Spade Icon -->
                                    <svg class="w-5 h-5 text-anthropic-dark" viewBox="0 0 24 24" fill="currentColor">
                                        <path
                                            d="M12 2.75C12 2.75 3 10.25 3 14.5C3 18.5 7 20 10.5 19.5L11 22H13L13.5 19.5C17 20 21 18.5 21 14.5C21 10.25 12 2.75 12 2.75Z" />
                                    </svg>
                                    <span>é»‘æ¡ƒ (Spade)</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    <label
                                        class="flex items-center gap-2 text-sm font-heading cursor-pointer text-anthropic-mid hover:text-anthropic-dark transition">
                                        <input type="checkbox" id="not-started-s" class="custom-checkbox align-middle">
                                        <span>æœªç ´å†°</span>
                                    </label>
                                    <span id="s-val"
                                        class="bg-anthropic-light px-3 py-1 rounded-full text-sm font-mono border border-anthropic-lightgray min-w-[70px] text-center">7
                                        - 7</span>
                                </div>
                            </div>
                            <div id="slider-s" class="color-spade h-2"></div>
                        </div>

                        <!-- Heart -->
                        <div class="suit-group">
                            <div
                                class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
                                <div class="flex items-center gap-2 font-heading font-semibold text-anthropic-dark">
                                    <!-- Solid Heart Icon -->
                                    <svg class="w-5 h-5 text-anthropic-orange" viewBox="0 0 24 24" fill="currentColor">
                                        <path
                                            d="M12 21.35L10.55 20.03C5.4 15.36 2 12.28 2 8.5C2 5.42 4.42 3 7.5 3C9.24 3 10.91 3.81 12 5.09C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.42 22 8.5C22 12.28 18.6 15.36 13.45 20.04L12 21.35Z" />
                                    </svg>
                                    <span>ç´…å¿ƒ (Heart)</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    <label
                                        class="flex items-center gap-2 text-sm font-heading cursor-pointer text-anthropic-mid hover:text-anthropic-dark transition">
                                        <input type="checkbox" id="not-started-h" class="custom-checkbox align-middle">
                                        <span>æœªç ´å†°</span>
                                    </label>
                                    <span id="h-val"
                                        class="bg-anthropic-light px-3 py-1 rounded-full text-sm font-mono border border-anthropic-lightgray min-w-[70px] text-center">7
                                        - 7</span>
                                </div>
                            </div>
                            <div id="slider-h" class="color-heart h-2"></div>
                        </div>

                        <!-- Club -->
                        <div class="suit-group">
                            <div
                                class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
                                <div class="flex items-center gap-2 font-heading font-semibold text-anthropic-dark">
                                    <!-- Solid Club Icon -->
                                    <svg class="w-5 h-5 text-anthropic-green" viewBox="0 0 24 24" fill="currentColor">
                                        <path
                                            d="M12 2C9.24 2 7 4.24 7 7C7 8.54 7.69 9.89 8.78 10.82C6.67 11.23 5 13.11 5 15.4C5 17.94 7.06 20 9.6 20C10.74 20 11.78 19.59 12.6 18.91L11.5 22H12.5L11.4 18.91C12.22 19.59 13.26 20 14.4 20C16.94 20 19 17.94 19 15.4C19 13.11 17.33 11.23 15.22 10.82C16.31 9.89 17 8.54 17 7C17 4.24 14.76 2 12 2Z" />
                                    </svg>
                                    <span>æ¢…èŠ± (Club)</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    <label
                                        class="flex items-center gap-2 text-sm font-heading cursor-pointer text-anthropic-mid hover:text-anthropic-dark transition">
                                        <input type="checkbox" id="not-started-c" class="custom-checkbox align-middle">
                                        <span>æœªç ´å†°</span>
                                    </label>
                                    <span id="c-val"
                                        class="bg-anthropic-light px-3 py-1 rounded-full text-sm font-mono border border-anthropic-lightgray min-w-[70px] text-center">7
                                        - 7</span>
                                </div>
                            </div>
                            <div id="slider-c" class="color-club h-2"></div>
                        </div>

                        <!-- Diamond -->
                        <div class="suit-group">
                            <div
                                class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2">
                                <div class="flex items-center gap-2 font-heading font-semibold text-anthropic-dark">
                                    <!-- Solid Diamond Icon -->
                                    <svg class="w-5 h-5 text-anthropic-blue" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12 2L2 12L12 22L22 12L12 2Z" />
                                    </svg>
                                    <span>æ–¹å¡Š (Diamond)</span>
                                </div>
                                <div class="flex items-center gap-3">
                                    <label
                                        class="flex items-center gap-2 text-sm font-heading cursor-pointer text-anthropic-mid hover:text-anthropic-dark transition">
                                        <input type="checkbox" id="not-started-d" class="custom-checkbox align-middle">
                                        <span>æœªç ´å†°</span>
                                    </label>
                                    <span id="d-val"
                                        class="bg-anthropic-light px-3 py-1 rounded-full text-sm font-mono border border-anthropic-lightgray min-w-[70px] text-center">7
                                        - 7</span>
                                </div>
                            </div>
                            <div id="slider-d" class="color-diamond h-2"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Settings, Hands, and Run. Vertically Stacked -->
            <div class="space-y-8 flex flex-col">

                <!-- Section: Compact Settings Row (Covers + Simulation) -->
                <div
                    class="bg-white p-6 md:p-8 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-anthropic-lightgray">
                    <h3 class="text-xl font-bold mb-6 heading-font text-anthropic-dark flex items-center gap-2">
                        <svg class="w-6 h-6 text-anthropic-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                            </path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        æ¨æ¼”è¨­å®š
                    </h3>

                    <!-- Form Grid Layout for Covers -->
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8 font-heading">
                        <div>
                            <label class="block text-xs font-semibold text-anthropic-dark mb-1">ç©å®¶ 1 (æˆ‘)</label>
                            <input type="number" id="cp1" value="0" min="0" max="13"
                                class="w-full px-3 py-2 bg-anthropic-light border border-anthropic-lightgray rounded-lg focus:outline-none focus:ring-2 focus:ring-anthropic-orange transition text-center">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-anthropic-dark mb-1">ç©å®¶ 2 è“‹ç‰Œ</label>
                            <input type="number" id="cp2" value="0" min="0" max="13"
                                class="w-full px-3 py-2 bg-anthropic-light border border-anthropic-lightgray rounded-lg focus:outline-none focus:ring-2 focus:ring-anthropic-orange transition text-center">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-anthropic-dark mb-1">ç©å®¶ 3 è“‹ç‰Œ</label>
                            <input type="number" id="cp3" value="0" min="0" max="13"
                                class="w-full px-3 py-2 bg-anthropic-light border border-anthropic-lightgray rounded-lg focus:outline-none focus:ring-2 focus:ring-anthropic-orange transition text-center">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-anthropic-dark mb-1">ç©å®¶ 4 è“‹ç‰Œ</label>
                            <input type="number" id="cp4" value="0" min="0" max="13"
                                class="w-full px-3 py-2 bg-anthropic-light border border-anthropic-lightgray rounded-lg focus:outline-none focus:ring-2 focus:ring-anthropic-orange transition text-center">
                        </div>
                    </div>

                    <!-- Layout for Slider -->
                    <div>
                        <label class="flex justify-between font-heading text-sm font-semibold text-anthropic-dark mb-4">
                            <span>æ¨æ¼”æ¨¹æ·±åº¦ (Simulations)</span>
                            <span id="sim-val"
                                class="font-mono bg-anthropic-lightgray px-3 py-1 rounded text-sm select-none">600</span>
                        </label>
                        <input type="range" id="sims" min="100" max="5000" step="100" value="600"
                            class="w-full h-2 bg-anthropic-lightgray rounded-lg appearance-none cursor-pointer accent-anthropic-orange focus:outline-none focus:ring-2 focus:ring-anthropic-orange/30">
                    </div>
                </div>

                <!-- Section: My Hand Cards -->
                <div
                    class="bg-white p-6 md:p-8 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-anthropic-lightgray flex-grow">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold heading-font text-anthropic-dark flex items-center gap-2">
                            <svg class="w-6 h-6 text-anthropic-blue" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11">
                                </path>
                            </svg>
                            æˆ‘çš„æ‰‹ç‰Œ
                        </h3>
                        <button id="clear-hand-btn"
                            class="font-heading text-xs font-semibold px-4 py-2 bg-anthropic-lightgray text-anthropic-dark hover:bg-anthropic-mid hover:text-white rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-anthropic-mid">
                            æ¸…ç©ºæ‰‹ç‰Œ
                        </button>
                    </div>

                    <div id="hand-selection-area" class="flex flex-col gap-5">
                        <!-- Constructed via JS -->
                    </div>
                </div>

                <!-- Run Button -->
                <button onclick="runAnalysis()" id="run-btn"
                    class="w-full py-5 bg-anthropic-orange text-white font-heading font-bold text-xl rounded-2xl shadow-lg hover:shadow-xl hover:bg-anthropic-hoverorange transform hover:-translate-y-1 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-anthropic-orange/50">
                    ğŸš€ é–‹å§‹æ¨æ¼”
                </button>

            </div>
        </div>

        <!-- Output Result Section -->
        <div id="result-section"
            class="mt-8 bg-anthropic-dark text-anthropic-light p-6 md:p-8 rounded-2xl shadow-[0_20px_50px_rgb(0,0,0,0.1)] hidden border border-gray-800">
            <h3 class="text-2xl font-bold mb-4 heading-font flex items-center gap-2">
                <svg class="w-6 h-6 text-anthropic-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
                æ¨æ¼”çµè«–èˆ‡æ€è€ƒæ—¥èªŒ
            </h3>
            <pre id="result-output"
                class="font-mono text-sm leading-relaxed whitespace-pre-wrap overflow-x-auto p-4 bg-black/40 rounded-xl custom-scrollbar border border-gray-700/50">ç­‰å¾…æ¨æ¼”å®Œæˆ...</pre>
        </div>

    </div>

    <!-- Script Block -->
    <script>
        // Use exactly the identical variable configs to hook into the Python backend!
        const suits = [
            { id: 's', name: 'Spade' },
            { id: 'h', name: 'Heart' },
            { id: 'c', name: 'Club' },
            { id: 'd', name: 'Diamond' }
        ];

        // --- Setup Range Sliders ---
        suits.forEach(s => {
            const slider = document.getElementById(`slider-${s.id}`);
            const checkbox = document.getElementById(`not-started-${s.id}`);
            const label = document.getElementById(`${s.id}-val`);

            noUiSlider.create(slider, {
                start: [7, 7], // Default is middle
                connect: true,
                range: { 'min': 1, 'max': 13 },
                step: 1,
                behavior: 'drag-tap', // Better UX for single point grabbing
                pips: { mode: 'values', values: [1, 7, 13], density: 4, format: wNumb({ decimals: 0 }) }
            });

            // Re-style UI pips
            setTimeout(() => {
                const sliderEl = document.getElementById(`slider-${s.id}`);
                sliderEl.querySelectorAll('.noUi-pips, .noUi-marker, .noUi-value').forEach(el => el.classList.add('text-xs', 'font-mono', 'text-anthropic-mid'));

                // Add Focus Event Listeners to fix Handle Z-index Overlap Issues on Slider creation
                const handles = sliderEl.querySelectorAll('.noUi-handle');
                handles.forEach(handle => {
                    handle.addEventListener('mousedown', function () {
                        handles.forEach(h => h.classList.remove('focus-top'));
                        this.classList.add('focus-top');
                    });
                    // Touch support
                    handle.addEventListener('touchstart', function () {
                        handles.forEach(h => h.classList.remove('focus-top'));
                        this.classList.add('focus-top');
                    }, { passive: true });
                });
            }, 100);

            // Slider Update Event
            slider.noUiSlider.on('update', function (values) {
                const v1 = Math.round(values[0]);
                const v2 = Math.round(values[1]);

                // Show values properly
                if (v1 === 7 && v2 === 7) {
                    label.innerText = `å‰›å‡º 7`;
                } else {
                    label.innerText = `${v1} â†” ${v2}`;
                }
            });

            // Checkbox Disable Event
            checkbox.addEventListener('change', function () {
                if (this.checked) {
                    slider.setAttribute('disabled', true);
                    label.innerText = 'æœªç ´å†°';
                    label.classList.add('opacity-50', 'bg-anthropic-lightgray');
                } else {
                    slider.removeAttribute('disabled');
                    label.classList.remove('opacity-50', 'bg-anthropic-lightgray');
                    // Force text re-eval
                    const curr = slider.noUiSlider.get();
                    const v1 = Math.round(curr[0]);
                    const v2 = Math.round(curr[1]);
                    label.innerText = (v1 === 7 && v2 === 7) ? `å‰›å‡º 7` : `${v1} â†” ${v2}`;
                }
            });
        });

        // --- Build Checklist Buttons ---
        const handArea = document.getElementById('hand-selection-area');
        // Use generic alphabet for picture cards
        const rankLabels = { 1: 'A', 11: 'J', 12: 'Q', 13: 'K' };

        suits.forEach(s => {
            const row = document.createElement('div');
            // Responsive Wrap for small screens, uniform grid on larger
            row.className = 'grid grid-cols-7 lg:grid-cols-13 gap-1.5';

            for (let r = 1; r <= 13; r++) {
                const labelTxt = rankLabels[r] || r.toString();
                const id = `card-${s.id}-${r}`;

                // The wrapper div
                const wrap = document.createElement('div');

                const chk = document.createElement('input');
                chk.type = 'checkbox';
                chk.id = id;
                chk.className = 'card-checkbox';

                const lbl = document.createElement('label');
                lbl.className = 'card-label-btn flex items-center justify-center py-2.5 rounded-lg font-mono text-sm shadow-sm';
                lbl.htmlFor = id;
                lbl.innerText = labelTxt;

                // Add soft colored bottom border accent to each card outline
                if (s.id === 's') lbl.classList.add('border-b-[3px]', 'border-b-anthropic-dark');
                if (s.id === 'h') lbl.classList.add('border-b-[3px]', 'border-b-anthropic-orange');
                if (s.id === 'c') lbl.classList.add('border-b-[3px]', 'border-b-anthropic-green');
                if (s.id === 'd') lbl.classList.add('border-b-[3px]', 'border-b-anthropic-blue');

                wrap.appendChild(chk);
                wrap.appendChild(lbl);
                row.appendChild(wrap);
            }
            handArea.appendChild(row);
        });

        // Slider real-time span update
        document.getElementById('sims').addEventListener('input', (e) => {
            document.getElementById('sim-val').innerText = e.target.value;
        });

        // Clear Hand Event
        document.getElementById('clear-hand-btn').addEventListener('click', () => {
            document.querySelectorAll('.card-checkbox').forEach(cb => cb.checked = false);
        });

        // --- Execute Analysis Payload ---
        async function runAnalysis() {
            const btn = document.getElementById('run-btn');
            const resSec = document.getElementById('result-section');
            const resOut = document.getElementById('result-output');

            btn.disabled = true;
            btn.innerHTML = `<svg class="animate-spin h-6 w-6 mr-3 hidden sm:inline-block border-[3px] border-white border-t-transparent rounded-full align-middle" viewBox="0 0 24 24"></svg><span class="align-middle">ğŸ¦Š ç¯€é»æš´é¢¨é‹ç®—ä¸­...</span>`;
            resSec.classList.remove('hidden');
            resOut.innerText = "æ­£åœ¨æ¨¡æ“¬å¯èƒ½ç‰Œå±€ä¸¦å»ºç«‹æ±ºç­–è’™åœ°å¡ç¾…æ¨¹ (MCTS)...";
            resSec.scrollIntoView({ behavior: "smooth", block: "start" });

            // Package the data exactly as the python server expects
            const data = {
                simulations: parseInt(document.getElementById('sims').value),
                covered: {
                    p1: parseInt(document.getElementById('cp1').value),
                    p2: parseInt(document.getElementById('cp2').value),
                    p3: parseInt(document.getElementById('cp3').value),
                    p4: parseInt(document.getElementById('cp4').value),
                },
                ranges: {},
                hand: []
            };

            // Calculate ranges based on slider values & checkbox state
            suits.forEach(s => {
                const notStarted = document.getElementById(`not-started-${s.id}`).checked;

                if (notStarted) {
                    // Send an empty array to denote suit is not started yet.
                    data.ranges[s.id] = [];
                } else {
                    const vals = document.getElementById(`slider-${s.id}`).noUiSlider.get();
                    data.ranges[s.id] = [Math.round(vals[0]), Math.round(vals[1])];
                }

                for (let r = 1; r <= 13; r++) {
                    if (document.getElementById(`card-${s.id}-${r}`).checked) {
                        data.hand.push(`${s.id.toUpperCase()}${r}`);
                    }
                }
            });

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                if (result.error) {
                    resOut.innerHTML = `<span class="text-anthropic-orange font-bold text-base">âš ï¸ ç™¼ç”ŸéŒ¯èª¤:</span>\n${result.error}`;
                } else {
                    resOut.innerText = result.output;
                }
            } catch (e) {
                resOut.innerHTML = `<span class="text-red-500 font-bold text-base">ğŸš« é€£ç·šå¤±æ•—: ä¼ºæœå™¨æ˜¯å¦é‹è¡Œä¸­ï¼Ÿ (${e})</span>`;
            }

            btn.disabled = false;
            btn.innerHTML = "ğŸš€ é–‹å§‹æ¨æ¼”";
        }
    </script>
</body>

</html>