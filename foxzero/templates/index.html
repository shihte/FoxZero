<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoxZero ç®—ç‰Œå™¨</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        anthropic: {
                            dark: '#141413',
                            light: '#faf9f5',
                            mid: '#b0aea5',
                            lightgray: '#e8e6dc',
                            orange: '#d97757',
                            blue: '#6a9bcc',
                            green: '#788c5d',
                            hoverorange: '#c26547'
                        }
                    },
                    fontFamily: {
                        heading: ['Poppins', 'Arial', 'sans-serif'],
                        body: ['Lora', 'Georgia', 'serif']
                    }
                }
            }
        }
    </script>
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=Poppins:wght@400;600;700&display=swap"
        rel="stylesheet">
    <!-- noUiSlider -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wnumb/1.2.0/wNumb.min.js"></script>

    <style>
        body {
            background-color: theme('colors.anthropic.light');
            color: theme('colors.anthropic.dark');
            font-family: theme('fontFamily.body');
        }

        h1,
        h2,
        h3,
        h4,
        .heading-font {
            font-family: theme('fontFamily.heading');
        }

        /* Customizes noUiSlider with Anthropic styling */
        .noUi-target {
            background: theme('colors.anthropic.lightgray');
            border-radius: 99px;
            border: none;
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.1);
        }

        .noUi-handle {
            background: #fff;
            border-radius: 50%;
            border: 2px solid theme('colors.anthropic.dark');
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: grab;
        }

        .noUi-handle:before,
        .noUi-handle:after {
            display: none;
        }

        .noUi-handle:active {
            cursor: grabbing;
        }

        /* Suit specific track colors based on Anthropic variants */
        .color-spade .noUi-connect {
            background: theme('colors.anthropic.dark');
        }

        .color-heart .noUi-connect {
            background: theme('colors.anthropic.orange');
        }

        .color-club .noUi-connect {
            background: theme('colors.anthropic.green');
        }

        .color-diamond .noUi-connect {
            background: theme('colors.anthropic.blue');
        }

        /* Custom checkbox cards for hand selection */
        .card-checkbox {
            display: none;
        }

        .card-label-btn {
            background: white;
            border: 1px solid theme('colors.anthropic.lightgray');
            transition: all 0.2s ease;
            cursor: pointer;
            user-select: none;
        }

        .card-checkbox:checked+.card-label-btn {
            background: theme('colors.anthropic.orange');
            color: white;
            border-color: theme('colors.anthropic.orange');
            font-weight: 600;
            transform: scale(1.05);
            /* Micro-animation */
            box-shadow: 0 4px 6px -1px rgba(217, 119, 87, 0.4);
        }

        .card-label-btn:hover {
            border-color: theme('colors.anthropic.mid');
        }
    </style>
</head>

<body class="min-h-screen py-10 px-4 md:px-0">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-anthropic-dark mb-3 tracking-tight">ğŸ¦Š FoxZero é‚è¼¯æ¨æ¼”ç®—ç‰Œå™¨</h1>
            <p class="text-anthropic-mid italic text-lg opacity-80">æ¡ç”¨äººå·¥æ™ºæ…§èˆ‡è‡ªæˆ‘å°å¼ˆæ¨æ¼”æ‚¨çš„æœ€ä½³æ­¥æ•¸</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- Left Column: Board & Cards -->
            <div class="md:col-span-2 space-y-8">

                <!-- Section 1: Desktop Status -->
                <div
                    class="bg-white p-6 md:p-8 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] transition hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)] border border-anthropic-lightgray">
                    <h3 class="text-2xl font-bold mb-2 heading-font text-anthropic-dark flex items-center gap-2">
                        <span>ğŸƒ</span> æ¡Œé¢ç‹€æ…‹ (å·²å‡ºçš„ç‰Œ)
                    </h3>
                    <p class="text-sm text-anthropic-mid mb-8 font-body">è«‹æ‹–æ›³æ»‘æ¡¿è¨­å®šæ¯ç¨®èŠ±è‰²å·²å‡ºçš„ç¯„åœ (åŒ…å« 7)ã€‚</p>

                    <div class="space-y-8">
                        <div class="suit-group">
                            <div
                                class="flex justify-between items-center mb-2 font-heading font-semibold text-anthropic-dark">
                                <span><span class="text-black text-xl">â™ ï¸</span> é»‘æ¡ƒ (Spade)</span>
                                <span id="s-val"
                                    class="bg-anthropic-light px-3 py-1 rounded-full text-sm font-mono border border-anthropic-lightgray">7
                                    - 7</span>
                            </div>
                            <div id="slider-s" class="color-spade h-2"></div>
                        </div>

                        <div class="suit-group">
                            <div
                                class="flex justify-between items-center mb-2 font-heading font-semibold text-anthropic-dark">
                                <span><span class="text-anthropic-orange text-xl">â¤ï¸</span> ç´…å¿ƒ (Heart)</span>
                                <span id="h-val"
                                    class="bg-anthropic-light px-3 py-1 rounded-full text-sm font-mono border border-anthropic-lightgray">7
                                    - 7</span>
                            </div>
                            <div id="slider-h" class="color-heart h-2"></div>
                        </div>

                        <div class="suit-group">
                            <div
                                class="flex justify-between items-center mb-2 font-heading font-semibold text-anthropic-dark">
                                <span><span class="text-anthropic-green text-xl">â™£ï¸</span> æ¢…èŠ± (Club)</span>
                                <span id="c-val"
                                    class="bg-anthropic-light px-3 py-1 rounded-full text-sm font-mono border border-anthropic-lightgray">7
                                    - 7</span>
                            </div>
                            <div id="slider-c" class="color-club h-2"></div>
                        </div>

                        <div class="suit-group">
                            <div
                                class="flex justify-between items-center mb-2 font-heading font-semibold text-anthropic-dark">
                                <span><span class="text-anthropic-blue text-xl">â™¦ï¸</span> æ–¹å¡Š (Diamond)</span>
                                <span id="d-val"
                                    class="bg-anthropic-light px-3 py-1 rounded-full text-sm font-mono border border-anthropic-lightgray">7
                                    - 7</span>
                            </div>
                            <div id="slider-d" class="color-diamond h-2"></div>
                        </div>
                    </div>
                </div>

                <!-- Section 3: My Hand Cards -->
                <div
                    class="bg-white p-6 md:p-8 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-anthropic-lightgray">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-2xl font-bold heading-font text-anthropic-dark flex items-center gap-2">
                            <span>ğŸ–ï¸</span> æˆ‘çš„æ‰‹ç‰Œ
                        </h3>
                        <button id="clear-hand-btn"
                            class="font-heading text-xs font-semibold px-3 py-1.5 bg-anthropic-lightgray text-anthropic-dark hover:bg-anthropic-mid hover:text-white rounded-md transition-colors">
                            æ¸…ç©ºæ‰‹ç‰Œ
                        </button>
                    </div>

                    <div id="hand-selection-area" class="flex flex-col gap-4">
                        <!-- Constructed via JS -->
                    </div>
                </div>
            </div>

            <!-- Right Column: Player Covered Cards & Settings -->
            <div class="space-y-8">

                <!-- Section 2: Player Covered Info -->
                <div
                    class="bg-white p-6 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-anthropic-lightgray">
                    <h3 class="text-xl font-bold mb-4 heading-font text-anthropic-dark flex items-center gap-2">
                        <span>ğŸ™ˆ</span> ç©å®¶è“‹ç‰Œæ•¸
                    </h3>

                    <div class="space-y-4 font-heading">
                        <div>
                            <label class="block text-sm font-semibold text-anthropic-dark mb-1">ç©å®¶ 1 (æˆ‘çš„è“‹ç‰Œæ•¸)</label>
                            <input type="number" id="cp1" value="0" min="0" max="13"
                                class="w-full px-4 py-2 bg-anthropic-light border border-anthropic-lightgray rounded-lg focus:outline-none focus:ring-2 focus:ring-anthropic-orange transition">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-anthropic-dark mb-1">ç©å®¶ 2 è“‹ç‰Œ</label>
                            <input type="number" id="cp2" value="0" min="0" max="13"
                                class="w-full px-4 py-2 bg-anthropic-light border border-anthropic-lightgray rounded-lg focus:outline-none focus:ring-2 focus:ring-anthropic-orange transition">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-anthropic-dark mb-1">ç©å®¶ 3 è“‹ç‰Œ</label>
                            <input type="number" id="cp3" value="0" min="0" max="13"
                                class="w-full px-4 py-2 bg-anthropic-light border border-anthropic-lightgray rounded-lg focus:outline-none focus:ring-2 focus:ring-anthropic-orange transition">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-anthropic-dark mb-1">ç©å®¶ 4 è“‹ç‰Œ</label>
                            <input type="number" id="cp4" value="0" min="0" max="13"
                                class="w-full px-4 py-2 bg-anthropic-light border border-anthropic-lightgray rounded-lg focus:outline-none focus:ring-2 focus:ring-anthropic-orange transition">
                        </div>
                    </div>
                </div>

                <!-- Section 4: Settings & Run -->
                <div
                    class="bg-white p-6 rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] border border-anthropic-lightgray">
                    <h3 class="text-xl font-bold mb-4 heading-font text-anthropic-dark flex items-center gap-2">
                        <span>ğŸ§ </span> AI æ¨æ¼”è¨­å®š
                    </h3>

                    <div class="mb-6">
                        <label class="flex justify-between font-heading text-sm font-semibold text-anthropic-dark mb-2">
                            <span>è’™åœ°å¡ç¾…æ¨¹æ·± (Simulations)</span>
                            <span id="sim-val" class="font-mono bg-anthropic-lightgray px-2 py-0.5 rounded">600</span>
                        </label>
                        <input type="range" id="sims" min="100" max="5000" step="100" value="600"
                            class="w-full h-2 bg-anthropic-lightgray rounded-lg appearance-none cursor-pointer accent-anthropic-orange">
                    </div>

                    <button onclick="runAnalysis()" id="run-btn"
                        class="w-full py-4 bg-anthropic-orange text-white font-heading font-bold text-lg rounded-xl shadow-lg hover:shadow-xl hover:bg-anthropic-hoverorange transform hover:-translate-y-0.5 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-anthropic-orange/30">
                        ğŸš€ é–‹å§‹æ¨æ¼”
                    </button>
                </div>

            </div>
        </div>

        <!-- Output Result Section -->
        <div id="result-section"
            class="mt-8 bg-anthropic-dark text-anthropic-light p-6 md:p-8 rounded-2xl shadow-[0_20px_50px_rgb(0,0,0,0.1)] hidden border border-gray-800">
            <h3 class="text-2xl font-bold mb-4 heading-font flex items-center gap-2">
                <span class="text-anthropic-blue">ğŸ“Š</span> æ¨æ¼”çµè«–èˆ‡æ€è€ƒæ—¥èªŒ
            </h3>
            <pre id="result-output"
                class="font-mono text-sm leading-relaxed whitespace-pre-wrap overflow-x-auto p-4 bg-black/30 rounded-lg custom-scrollbar">ç­‰å¾…æ¨æ¼”å®Œæˆ...</pre>
        </div>

    </div>

    <!-- Script Block -->
    <script>
        // Use exactly the identical variable configs to hook into the Python backend!
        const suits = [
            { id: 's', name: 'Spade' },
            { id: 'h', name: 'Heart' },
            { id: 'c', name: 'Club' },
            { id: 'd', name: 'Diamond' }
        ];

        // --- Setup Range Sliders ---
        suits.forEach(s => {
            const slider = document.getElementById(`slider-${s.id}`);
            noUiSlider.create(slider, {
                start: [7, 7], // Default is middle
                connect: true,
                range: { 'min': 1, 'max': 13 },
                step: 1,
                pips: { mode: 'values', values: [1, 7, 13], density: 4, format: wNumb({ decimals: 0 }) }
            });

            // Re-style UI pips
            setTimeout(() => {
                document.querySelectorAll('.noUi-pips, .noUi-marker, .noUi-value').forEach(el => el.classList.add('text-xs', 'font-mono', 'text-anthropic-mid'));
            }, 100);

            slider.noUiSlider.on('update', function (values) {
                const v1 = Math.round(values[0]);
                const v2 = Math.round(values[1]);
                const label = document.getElementById(`${s.id}-val`);

                // Show values properly
                if (v1 === 7 && v2 === 7) {
                    label.innerText = `å‰›å‡º 7 (æˆ–å³å°‡å‡º 7)`;
                } else {
                    label.innerText = `${v1} â†” ${v2}`;
                }
            });
        });

        // --- Build Checklist Buttons ---
        const handArea = document.getElementById('hand-selection-area');
        const suitSymbols = { s: 'â™ ï¸', h: 'â¤ï¸', c: 'â™£ï¸', d: 'â™¦ï¸' };

        // Use generic alphabet for picture cards
        const rankLabels = { 1: 'A', 11: 'J', 12: 'Q', 13: 'K' };

        suits.forEach(s => {
            const row = document.createElement('div');
            row.className = 'grid grid-cols-7 md:grid-cols-13 gap-1 md:gap-1.5';

            for (let r = 1; r <= 13; r++) {
                const labelTxt = rankLabels[r] || r.toString();
                const id = `card-${s.id}-${r}`;

                // The wrapper div
                const wrap = document.createElement('div');

                const chk = document.createElement('input');
                chk.type = 'checkbox';
                chk.id = id;
                chk.className = 'card-checkbox';

                const lbl = document.createElement('label');
                lbl.className = 'card-label-btn flex items-center justify-center py-2 rounded font-mono text-sm';
                lbl.htmlFor = id;
                lbl.innerText = labelTxt;

                // Add soft colored bottom border accent to each card outline
                if (s.id === 's') lbl.classList.add('border-b-4', 'border-b-anthropic-dark');
                if (s.id === 'h') lbl.classList.add('border-b-4', 'border-b-anthropic-orange');
                if (s.id === 'c') lbl.classList.add('border-b-4', 'border-b-anthropic-green');
                if (s.id === 'd') lbl.classList.add('border-b-4', 'border-b-anthropic-blue');

                wrap.appendChild(chk);
                wrap.appendChild(lbl);
                row.appendChild(wrap);
            }
            handArea.appendChild(row);
        });

        // Slider real-time span update
        document.getElementById('sims').addEventListener('input', (e) => {
            document.getElementById('sim-val').innerText = e.target.value;
        });

        // Clear Hand Event
        document.getElementById('clear-hand-btn').addEventListener('click', () => {
            document.querySelectorAll('.card-checkbox').forEach(cb => cb.checked = false);
        });

        // --- Execute Analysis Payload ---
        async function runAnalysis() {
            const btn = document.getElementById('run-btn');
            const resSec = document.getElementById('result-section');
            const resOut = document.getElementById('result-output');

            btn.disabled = true;
            btn.innerHTML = `<svg class="animate-spin h-5 w-5 mr-3 hidden sm:inline-block border-2 border-white border-t-transparent rounded-full" viewBox="0 0 24 24"></svg> ğŸ¦Š ç¯€é»æš´é¢¨é‹ç®—ä¸­...`;
            resSec.classList.remove('hidden');
            resOut.innerText = "æ­£åœ¨æ¨¡æ“¬å¯èƒ½ç‰Œå±€ä¸¦å»ºç«‹æ±ºç­–è’™åœ°å¡ç¾…æ¨¹ (MCTS)...";
            resSec.scrollIntoView({ behavior: "smooth", block: "start" });

            // Package the data exactly as the python server expects
            const data = {
                simulations: parseInt(document.getElementById('sims').value),
                covered: {
                    p1: parseInt(document.getElementById('cp1').value),
                    p2: parseInt(document.getElementById('cp2').value),
                    p3: parseInt(document.getElementById('cp3').value),
                    p4: parseInt(document.getElementById('cp4').value),
                },
                ranges: {},
                hand: []
            };

            // Calculate ranges based on slider values
            suits.forEach(s => {
                const vals = document.getElementById(`slider-${s.id}`).noUiSlider.get();
                data.ranges[s.id] = [Math.round(vals[0]), Math.round(vals[1])];

                for (let r = 1; r <= 13; r++) {
                    if (document.getElementById(`card-${s.id}-${r}`).checked) {
                        data.hand.push(`${s.id.toUpperCase()}${r}`);
                    }
                }
            });

            try {
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                if (result.error) {
                    resOut.innerHTML = `<span class="text-anthropic-orange">ç™¼ç”ŸéŒ¯èª¤:</span>\n${result.error}`;
                } else {
                    resOut.innerText = result.output;
                }
            } catch (e) {
                resOut.innerHTML = `<span class="text-red-500 font-bold">é€£ç·šå¤±æ•—: ä¼ºæœå™¨æ˜¯å¦é‹è¡Œä¸­ï¼Ÿ (${e})</span>`;
            }

            btn.disabled = false;
            btn.innerHTML = "ğŸš€ é–‹å§‹æ¨æ¼”";
        }
    </script>
</body>

</html>