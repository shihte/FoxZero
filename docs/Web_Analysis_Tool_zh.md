# 🦊 FoxZero 邏輯推演算牌器 (Web Analysis Tool)

## 📖 工具簡介 (Introduction)

**FoxZero 邏輯推演算牌器** 是一個專為「排七 (Sevens)」紙牌遊戲打造的輔助分析網頁應用程式 (Web Application)。它將強大的 AlphaZero 架構 (也就是專案中的 `FoxZeroResNet`) 與蒙地卡羅樹搜尋 (MCTS) 推演引擎視覺化，讓玩家或開發者可以透過直覺的網頁操作介面，設定當前的牌局狀態（桌面已發牌、各玩家蓋牌數量、我方手牌），並由人工智慧模型即時推算出勝率最高的「下一步推薦出牌」。

這套系統不依賴作弊手段預視對手底牌，而是基於「邏輯模式 (Logic Mode)」嚴格遵循現有公開資訊，產生合法且符合現實機率分佈的推演結果。

---

## ✨ 介面設計與設計語彙 (Interface & Design Language)

本次重構採用了 **Anthropic 官方設計原則 (Brand Guidelines)** 進行現代化視覺升級，保證了閱讀舒適度與專業質感：

### 色階配置 (Color Palette)
- **核心色彩**：採用柔和且高度護眼的亮色系背景 `#faf9f5` (Light Backgroud) 作為基底搭配極深灰色 `#141413` (Dark) 作為主要文字色彩，降低長期注視的視覺疲勞。
- **互動提示色 (Accent Colors)**：
  - **橘色 (`#d97757`)**：作為主要的視覺強調重點與「推演按鈕」背景，帶來充滿活力且高識別度的互動感。
  - **藍色 (`#6a9bcc`) & 綠色 (`#788c5d`)**：作為次級資訊或輔助提示顏色的漸層與懸浮 (Hover) 變化。

### 字體美學 (Typography)
導入現代感字型組合：
- **標題 (Headings)**：全面採用 `Poppins`（若無則回退至 `Arial`），帶來現代、圓潤且極具科技感的標題層級。
- **內文 (Body Text)**：採用 `Lora`（若無則回退至 `Georgia`），兼具人文質感與極高易讀性的襯線字體，提升文字段落的典雅氣質。

### 框架與互動 (Framework & Interaction)
- 導入 **Tailwind CSS** (透過 CDN) 來精確控制響應式佈局 (Responsive Design)，在手機及桌面端皆能完美適配。
- 使用 **noUiSlider** 實作花色區間滑桿，滑桿軌道 (Track) 與焦點 (Connect) 也針對四大花色（黑桃、紅心、梅花、方塊）設計了對應的色調映射。
- 深度整合了微動畫 (Micro-animations)：如按鈕點擊縮放效果、懸浮陰影擴大，營造出頂級 (Premium) 應用的細膩回饋感。

---

## 🧠 推演邏輯 (Inference Logic)

網頁工具結合了前端的資料搜集與後端的 `run_analysis` 引擎：

1. **狀態收集 (State Assembly)**：
   - 使用者在前端以拉桿 (Slider) 設定桌面上已打出的牌範圍（預設 7 必出）。
   - 設定其他玩家的蓋牌總數與自身目前剩餘的手牌。
   - 這些參數會經由 JSON Payload 打向後端的 `/analyze` Flask 端點。

2. **歷史狀態重建 (History Reconstruction)**：
   - 透過擷取桌面打出的卡牌總數與蓋牌數，計算總回合輪轉 (Total Actions)。
   - 結合剩餘未被分配的卡牌池，自動將剩餘的「未知牌」隨機並均勻地配發給對手的覆蓋牌堆 (Covered Piles) 以及對手剩餘手牌 (Opponent Hands) 中，藉由「抽樣模擬 (Determinization)」填補非公開資訊。

3. **蒙地卡羅樹搜尋 (MCTS) 推演**：
   - 在補全合法局面的前提下，後端調用預載好的 `foxzero_weights.pth` (殘差卷積判定模型)。
   - 透過使用者設定的「推演次數 (Simulations)」（例如次預設 600 次），模型反覆在自我對弈中試探每個可能出牌的價值 (Value) 以及獲勝機率 (Policy)。
   - 輸出一張評分最高的卡片作為「建議出牌」，並將完整思考日誌 (Thinking Log) 拋回前端展示。

---

## 🚀 使用說明 (Usage Instructions)

1. **啟動 Web UI**：
   在根目錄中執行以下指令以啟動後端伺服器：
   ```bash
   python3 scripts/web_app.py
   ```
   伺服器會運作於 `http://127.0.0.1:8080`，請打開您的瀏覽器進入此位置。

2. **步驟 1：桌面狀態 (已出的牌)**
   - 拖曳畫面中的「區間滑桿」來設定目前黑桃、紅心、梅花、方塊在桌面上打出的下限 (Min) 到上限 (Max)。
   - 如果該花色尚未破冰 (連 7 都還沒出)，您可以將其值卡在 7-7 （系統與後端會判定為僅等待發動或剛出 7 的狀態）。

3. **步驟 2：玩家蓋牌數**
   - 視窗右側輸入欄位用於登記各家「現存的蓋牌數量」。
   - 特別注意：「玩家 1」系統內定為目前的「我方 (User)」。請精確輸入別家已經吃下的覆蓋牌，以免殘牌池分配不均。

4. **步驟 3：我的手牌**
   - 在按鈕區域勾選目前手上的實際持牌。為求推算精準，請確保勾選數量與輪次邏輯吻合。
   - 系統提供了「清空手牌」按鈕以方便新一局的快速重置。

5. **步驟 4：開始推演**
   - 調整底部的「推演次數 (Simulations)」。預設 600 足以應付大部分中段局勢，若在極端殘局或起手，可拉高至 1500 以上增加準度，但所需等待秒數也會隨之攀升。
   - 點擊「🚀 開始推演 (Calculate Best Move)」按鈕。
   - 等待數秒後，下方卡片將展開並告訴您 FoxZero 算出的「✅ 建議出牌」，附帶 MCTS 的節點訪問樹狀紀錄以供深度覆盤參考。
